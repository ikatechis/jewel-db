<!-- jewel_db/templates/items_list.html -->
{% extends "base.html" %}

{% block title %}All Jewelry Items{% endblock %}

{% block content %}
  <!-- Filter form -->
  <form
    method="get"
    action="{{ url_for('list_items_page') }}"
    class="mb-6 flex flex-wrap items-center space-x-4"
  >
    <input
      type="text"
      name="q"
      placeholder="Search"
      value="{{ q or '' }}"
      class="border border-gray-300 rounded px-3 py-2 flex-1"
    />

    <select name="material" class="border border-gray-300 rounded px-3 py-2">
      <option value="">All Materials</option>
      {% for m in materials %}
        <option value="{{ m }}" {% if m == material %}selected{% endif %}>
          {{ m }}
        </option>
      {% endfor %}
    </select>

    <select name="gemstone" class="border border-gray-300 rounded px-3 py-2">
      <option value="">All Gemstones</option>
      <!-- explicit “None” -->
      <option value="None" {% if gemstone=='None' %}selected{% endif %}>
        None
      </option>
      {% for g in gemstones %}
        {% if g %}
          <option value="{{ g }}" {% if g == gemstone %}selected{% endif %}>
            {{ g }}
          </option>
        {% endif %}
      {% endfor %}
    </select>

    <button type="submit" class="bg-blue-600 text-white rounded px-4 py-2">
      Filter
    </button>
  </form>


  <!-- Stats panel -->
  <div class="grid grid-cols-4 gap-4 mb-6 text-center">
    <div>
      <h4 class="font-medium">Total Items</h4>
      <p>{{ total_count }}</p>
    </div>
    <div>
      <h4 class="font-medium">Avg Price</h4>
      <p>{{ '%.2f'|format(avg_price) }} €</p>
    </div>
    <div>
      <h4 class="font-medium">Total Weight</h4>
      <p>{{ '%.2f'|format(total_weight) }} g</p>
    </div>
    <div>
      <h4 class="font-medium">No Image</h4>
      <p>{{ no_count }}</p>
    </div>
  </div>

  <!-- View toggles -->
  <div class="mb-4">
    <button id="gridView" class="px-3 py-1 bg-gray-200 rounded">Grid View</button>
    <button id="listView" class="px-3 py-1 bg-gray-200 rounded">List View</button>
  </div>

  <!-- Grid display -->
  <div id="grid" class="grid grid-cols-3 gap-6">
    {% for item in items %}
      <div class="bg-white shadow rounded p-4">
        {% if thumbs[item.id] %}
          <img
            src="{{ thumbs[item.id] }}"
            alt="{{ item.name }}"
            class="h-32 w-full object-cover mb-2 rounded"
          />
        {% else %}
          <div class="h-32 w-full bg-gray-100 mb-2 rounded flex items-center justify-center">
            No Image
          </div>
        {% endif %}
        <h5 class="font-semibold">{{ item.name }}</h5>
        <p class="text-sm text-gray-600">{{ item.material or '—' }}</p>
        <p class="text-sm">{{ '%.2f'|format(item.price) }} €</p>
        <a
          href="{{ url_for('item_detail', item_id=item.id) }}"
          class="text-blue-600 hover:underline"
        >
          View
        </a>
      </div>
    {% endfor %}
  </div>

  <!-- Table display -->
  <table
    id="list"
    class="min-w-full mt-6 hidden bg-white shadow rounded overflow-hidden"
  >
    <thead class="bg-gray-100">
      <tr>
        <th class="px-4 py-2 text-left">Name</th>
        <th class="px-4 py-2 text-left">Image</th>
        <th class="px-4 py-2 text-left">Material</th>
        <th class="px-4 py-2 text-left">Gemstone</th>
        <th class="px-4 py-2 text-left">
          Weight
          {% if sort_by=='weight' %}{{ sort_dir=='asc' and '↑' or '↓' }}{% endif %}
        </th>
        <th class="px-4 py-2 text-left">
          Price
          {% if sort_by=='price' %}{{ sort_dir=='asc' and '↑' or '↓' }}{% endif %}
        </th>
        <th class="px-4 py-2 text-left">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
        <tr class="border-b">
          <td class="px-4 py-2">{{ item.name }}</td>
          <td class="px-4 py-2">
            {% if thumbs[item.id] %}
              <img
                src="{{ thumbs[item.id] }}"
                alt="{{ item.name }}"
                class="h-12 w-12 object-cover rounded"
              />
            {% else %}
              —
            {% endif %}
          </td>
          <td class="px-4 py-2">{{ item.material or '—' }}</td>
          <td class="px-4 py-2">
            {% if item.gemstone %}
              {{ item.gemstone }}
            {% else %}
              —
            {% endif %}
          </td>
          <td class="px-4 py-2">{{ '%.2f'|format(item.weight) }}</td>
          <td class="px-4 py-2">{{ '%.2f'|format(item.price) }} €</td>
          <td class="px-4 py-2">
            <a
              href="{{ url_for('item_detail', item_id=item.id) }}"
              class="text-blue-600 hover:underline"
            >
              View
            </a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="mt-6 flex justify-center items-center space-x-4">
    {% if page > 1 %}
      <a
        href="{{ url_for('list_items_page', page=page-1, q=q, material=material, gemstone=gemstone) }}"
        class="px-3 py-1 bg-gray-200 rounded"
      >
        Prev
      </a>
    {% endif %}
    <span>Page {{ page }} of {{ total_pages }}</span>
    {% if page < total_pages %}
      <a
        href="{{ url_for('list_items_page', page=page+1, q=q, material=material, gemstone=gemstone) }}"
        class="px-3 py-1 bg-gray-200 rounded"
      >
        Next
      </a>
    {% endif %}
  </div>
{% endblock %}

{% block scripts %}
<script>
  const gridView = document.getElementById('gridView');
  const listView = document.getElementById('listView');
  const grid = document.getElementById('grid');
  const list = document.getElementById('list');

  gridView.addEventListener('click', () => {
    grid.classList.remove('hidden');
    list.classList.add('hidden');
  });
  listView.addEventListener('click', () => {
    list.classList.remove('hidden');
    grid.classList.add('hidden');
  });
</script>
{% endblock %}
