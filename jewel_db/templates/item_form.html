<!-- jewel_db/templates/item_form.html -->
{% extends "base.html" %}
{% block title %}{% if item %}Edit {{ item.name }}{% else %}Add New Item{% endif %}{% endblock %}

{% block content %}
<form id="item-form" class="space-y-4" enctype="multipart/form-data">
  <input type="hidden" name="id" value="{{ item.id if item }}">

  <div>
    <label class="block mb-1">Name</label>
    <input
      type="text"
      name="name"
      value="{{ item.name if item else '' }}"
      required
      class="w-full border rounded p-2"
    >
    <div class="error-msg text-red-600 text-sm mt-1"></div>
  </div>

  <div>
    <label class="block mb-1">Material</label>
    <input
      name="material"
      value="{{ item.material if item else '' }}"
      class="w-full border rounded p-2"
    >
    <div class="error-msg text-red-600 text-sm mt-1"></div>
  </div>

  <div>
    <label class="block mb-1">Gemstone</label>
    <input
      list="gemstone-list"
      name="gemstone"
      value="{{ item.gemstone if item else '' }}"
      placeholder="Select or type…"
      class="w-full border rounded p-2"
    >
    <datalist id="gemstone-list">
      <option value="Diamond"><option value="Ruby"><option value="Sapphire">
      <option value="Emerald"><option value="Pearl"><option value="Opal">
      <option value="Other">
    </datalist>
    <div class="error-msg text-red-600 text-sm mt-1"></div>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block mb-1">Weight (g)</label>
      <input
        type="number"
        step="0.01"
        name="weight"
        value="{{ item.weight if item else 0 }}"
        class="w-full border rounded p-2"
      >
      <div class="error-msg text-red-600 text-sm mt-1"></div>
    </div>
    <div>
      <label class="block mb-1">Price</label>
      <input
        type="number"
        step="0.01"
        name="price"
        value="{{ item.price if item else 0 }}"
        class="w-full border rounded p-2"
      >
      <div class="error-msg text-red-600 text-sm mt-1"></div>
    </div>
  </div>

  <div>
    <label class="block mb-1">Upload Images</label>
    <input
      type="file"
      id="file-input"
      name="files"
      multiple
      accept="image/*"
      class="w-full"
    >
    <div class="error-msg text-red-600 text-sm mt-1"></div>
  </div>

  <div>
    <label class="block mb-1">—or Image URL</label>
    <input
      type="url"
      id="url-input"
      name="image_url"
      placeholder="https://…"
      value="{{ item.image_url if item else '' }}"
      class="w-full border rounded p-2"
    >
    <div class="error-msg text-red-600 text-sm mt-1"></div>
  </div>

  <div>
    <label class="block mb-1">Description</label>
    <textarea
      name="description"
      class="w-full border rounded p-2"
    >{{ item.description if item else '' }}</textarea>
    <div class="error-msg text-red-600 text-sm mt-1"></div>
  </div>

  <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">
    {% if item %}Save{% else %}Create{% endif %}
  </button>
</form>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('item-form');
  const fileInput = document.getElementById('file-input');
  const urlInput = document.getElementById('url-input');

  form.addEventListener('submit', (e) => {
    // Clear previous errors
    document.querySelectorAll('.error-msg').forEach(el => el.textContent = '');

    const file = fileInput.files[0];
    const url = urlInput.value.trim();

    // Only validate file type if a file is selected
    if (file) {
      if (!file.type.startsWith('image/')) {
        e.preventDefault();
        fileInput.nextElementSibling.textContent = 'Invalid image type';
        return;
      }
    }

    // Allow empty selection (no image) or only URL; no warning needed
    if (!file && url) {
      // URL-only case: optionally could validate URL format here
      return;
    }

    // Both file and URL empty: that's OK, proceed without image
  });
});
</script>
{% endblock %}
